<html>
  <head>
    <style>
      canvas {
        width: 600px;
        height: 400px;
      }
    </style>
    <script src="../three_js/build/three.min.js"></script>
    <script src="../three_js/examples/js/controls/OrbitControls.js"></script>
    <script src="nodes.js"></script>
    
    <script src="lib/node.js"></script>
    <script src="lib/connection.js"></script>
  </head>
  <body>
    <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, .01, 1000);
      
      
      camera.position.z = 50;
      camera.lookAt(new THREE.Vector3(1,0,0));
      
      var renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0xffffff, 1);
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      
      document.body.appendChild(renderer.domElement);
      
      var nodes = [];
      
      for(var i = 0; i < 5; i++) {
        var position = Node.calcRandomPosition();
        nodes.push(new Node(0.5, position));
      }
      
      nodes.forEach(function (node) {
        scene.add(node.mesh);
      });
      
      function moveNodes (nodes) {
        nodes.forEach(function (node) {
          
          node.moveToDestination();
          //node.moveConnections();
          if(node._distanceToDestination() < 2) {
            node.changeDestination();
          }
        });
      };
      
      function removeConnections(nodes) {
        nodes.forEach(function (node) {
          var connections = node.removeConnections();
          
          connections.forEach(function (connection) {
            scene.remove(connection.line);
          })
        });
      }
      
      function drawConnections (nodes) {
        nodes.forEach(function (node) {
          nodes.forEach(function (otherNode) {
            if(node !== otherNode) {
              var connection = node.addConnection(otherNode);
               //draw a line from node vertex to other node vertex
              if(connection) scene.add(connection.line);
            }
          });
        });
      };
      
      // geometry = new THREE.Geometry();
//       
//       var v = new THREE.Vector3(0, 0, 0);
//       var v2 = new THREE.Vector3(0, -10, 0);
//       
//       
//       geometry.vertices.push(v);
//       geometry.vertices.push(v2);
//       
//       material = new THREE.LineBasicMaterial({ color: 0xff0000 });
//       
//       var line = new THREE.Line(geometry, material);
//       
//       line.geometry.dynamic = true;
//       line.geometry.verticesNeedUpdate = true;
//       line.geometry.normalsNeedUpdate = true;
//       
//       scene.add(line);
//       
//       x = 10;
      
      function render () {
        requestAnimationFrame(render);
        moveNodes(nodes);
        removeConnections(nodes);
        drawConnections(nodes);
        renderer.render(scene, camera);
        controls.update();
      }
      
      render();
    </script>
  </body>
</html>